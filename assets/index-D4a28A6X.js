(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();function $(r){const e=new Date;e.setDate(e.getDate()+r);const t=new Intl.DateTimeFormat("ru",{month:"short"}).format(e).replace(".",""),a=new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e),o=new Intl.DateTimeFormat("ru",{weekday:"short"}).format(e);return`${t.charAt(0).toUpperCase()+t.slice(1)} ${a}, ${o.charAt(0).toUpperCase()+o.slice(1)}`}const C="https://api.weatherapi.com/v1",x="4a900778688045d887d103458252808";async function F(r,e){try{const t=await fetch(`${C}/forecast.json?key=${x}&q=${r}&days=${e}&aqi=no&alerts=no`);if(!t.ok)throw new Error(`Запрос вернулся с ошибкой ${t.status}`);return await t.json()}catch(t){return console.error(t),null}}function v(r){return r.slice(11,16)}function i(r,e){e||(e=document);const t=e.querySelector(r);if(!t)throw new Error(`отсутствует: ${r}`);return t}const h={today:{days:1,dateDays:0,currentPeriod:"time"},tommorow:{days:2,dateDays:1,currentPeriod:"time"},threeDay:{days:3,dateDays:2,currentPeriod:"date"}},I={celcium:"℃",farenheight:"℉"};class S{currentDateMode="today";unit="celcium";weatherData=null;async getWeather(e){const t=h[this.currentDateMode].days;if(this.weatherData=await F(e,t),!this.weatherData)throw new Error("weatherData не существует");return this.getFormattedDataFromApi(this.weatherData)}toggleUnitTemperature(){return this.unit==="celcium"?this.unit="farenheight":this.unit="celcium"}get unitSymbolTemperature(){return I[this.unit]}getTempKeyDayCurrent(e){try{return e==="celcium"?{current:"temp_c",avg:"avgtemp_c"}:{current:"temp_f",avg:"avgtemp_f"}}catch{throw new Error("unexpected unit: "+e)}}getFormattedDataFromApi(e){const{location:t,current:a,forecast:o}=e,n=this.getTempKeyDayCurrent(this.unit),s=h[this.currentDateMode].dateDays;return this.currentDateMode==="today"?{location:t.name,localtime:t.localtime,temperature:a[n.current],img:a.condition.icon,imgText:a.condition.text,humidity:a.humidity,vis:a.vis_km,precip:a.precip_mm,wind:a.wind_kph}:{location:t.name,localtime:t.localtime,temperature:o.forecastday[s].day[n.avg],img:o.forecastday[s].day.condition.icon,imgText:o.forecastday[s].day.condition.text,humidity:o.forecastday[s].day.avghumidity,vis:o.forecastday[s].day.avgvis_km,precip:o.forecastday[s].day.totalprecip_mm,wind:o.forecastday[s].day.maxwind_kph}}getWeatherForDay(e){const t=[],{forecast:a}=e;let o=null;this.currentDateMode==="today"?o=a.forecastday[0].hour:o=a.forecastday[1].hour;const n=o.filter((d,E)=>E%2===0),s=this.getTempKeyDayCurrent(this.unit);for(let d=0;d<n.length;d++)t.push({time:v(n[d].time),imgUrl:n[d].condition.icon,imgText:n[d].condition.text,temperature:Math.round(n[d][s.current])});return t}getWeatherForThreeDay(e){const t=[],a=e.forecast.forecastday,o=this.getTempKeyDayCurrent(this.unit);if(!a)throw new Error("daysSort не существует");for(let n=0;n<a.length;n++)t.push({date:a[n].date.split("-").reverse().join("-"),imgUrl:a[n].day.condition.icon,imgText:a[n].day.condition.text,temperature:Math.round(a[n].day[o.avg])});return t}getDataRenderFooter(){if(!this.weatherData)throw new Error("weatherData не существует");return this.currentDateMode==="threeDay"?this.getWeatherForThreeDay(this.weatherData):this.getWeatherForDay(this.weatherData)}}const W=i(".hero__weather-wrapper"),A=document.querySelectorAll(".header__item");i(".header");const k=i(".header__button--today"),P=i(".header__button--tommorow"),b=i(".header__button--three-days");function p(r){const e=[...A];e.forEach(a=>a.classList.remove("header__item--current"));const t=e.find(a=>a.dataset.mode===r);if(t)t.classList.add("header__item--current");else{console.warn(`Кнопка с data-mode="${r}" не найдена`);return}}class O{parent;headerTime=i(".header__time");weatherClockList=i(".footer__list");footerTemplate=i(".footer__template").content;itemTemplate=i(".footer__item",this.footerTemplate);constructor(e){this.parent=e}renderWeatherHero(e,t,a,o){const n=`
      <div class="hero__box">
        <div class="hero__location-box">
          <p class="hero__location">${t}</p>
          <p class="hero__date">${a}</p>
        </div>
        <div class="hero__temperature-box">
          <p class="hero__temperature">${Math.round(e.temperature)}${o}</p>
          <img src="${e.img}" alt="${e.imgText}">
        </div>
      </div>
      <ul class="hero__list">
        <li class="hero__item">
          <p class="hero__weather-data">Влажность</p>
          <p class="hero__weather-parameter">
            <span class="hero__humidity">${e.humidity}</span>
            %
          </p>
        </li>
        <li class="hero__item">
          <p class="hero__weather-data">Видимость</p>
          <p class="hero__weather-parameter">
            <span class="hero__mileage">${e.vis}</span>
            км
          </p>
        </li>
        <li class="hero__item">
          <p class="hero__weather-data">Осадки</p>
          <p class="hero__weather-parameter">
            <span class="hero__pressure">${Math.ceil(e.precip)}</span>
            мм.
          </p>
        </li>
        <li class="hero__item">
          <p class="hero__weather-data">Ветер</p>
          <p class="hero__weather-parameter">
            <span class="hero__speed">${Math.round(e.wind)}</span>
            м/с
          </p>
        </li>
      </ul>`;this.parent.innerHTML=n,this.headerTime.innerHTML=v(e.localtime)}renderFooter(e){this.weatherClockList.innerHTML="";for(let t=0;t<e.footerItems.length;t++){const a=this.itemTemplate?.cloneNode(!0),o=i(".footer__time",a),n=i(".footer__img",a),s=i(".footer__temperature",a);o.textContent=String(e.footerItems[t][e.period]),n.src=e.footerItems[t].imgUrl,n.alt=e.footerItems[t].imgText,s.textContent=String(e.footerItems[t].temperature)+e.unitMeasurement,this.weatherClockList.appendChild(a)}}}const _=new O(W),m=document.querySelector(".header__toggle");function U(r){r==="farenheight"?m?.classList.add("header__toggle--on"):m?.classList.remove("header__toggle--on")}const f=i(".dialog"),g=i(".dialog__text"),w=i(".dialog__loader");async function D(r){const e=setTimeout(()=>f.showModal(),150);try{g.textContent="Загрузка данных...",w.style.display="flex";const t=await r;return clearTimeout(e),f.close(),t}catch(t){g.textContent="Ошибка загрузки данных. Попробуйте ещё раз.",w.style.display="none",console.error(t)}}const y=i(".hero__input"),M=i(".hero__input-error");function L(){return y.value.trim()}function T(){M.classList.remove("hero__input-error--hidden")}function K(r){(r===""||r.length>=3)&&M.classList.add("hero__input-error--hidden")}const N="2c400ae7e35c5ee43924eddd40328031",H="https://api.openweathermap.org/geo/1.0";async function R(r){try{const e=await fetch(`${H}/direct?q=${r}&limit=1&appid=${N}`);if(!e.ok)throw new Error(`Запрос вернулся с ошибкой ${e.status}`);return await e.json()}catch(e){return console.error(e),null}}class q{location="Москва";cityName=null;async getCity(){const e=await R(this.location);return!e||e.length===0?(console.log("Такого города не существует"),null):(this.cityName=e,this.cityName)}}const c=new S,u=new q;async function l(){const r=await D(u.getCity());if(!r)throw T(),new Error("Города не существует");const e=await D(c.getWeather(r[0].name));if(!e)throw T(),new Error("weatherData не существует");B(e)}async function B(r){const e=h[c.currentDateMode],t=$(e.dateDays),a=c.getDataRenderFooter(),o=u.cityName[0].local_names.ru;_.renderWeatherHero(r,o,t,c.unitSymbolTemperature),_.renderFooter({footerItems:a,period:e.currentPeriod,unitMeasurement:c.unitSymbolTemperature})}l();const Y=()=>{const r=L();u.location!==r&&(u.location=r,l())};y.addEventListener("keydown",r=>{r.key==="Enter"&&Y()});y.addEventListener("input",()=>{const r=L();K(r)});m?.addEventListener("click",()=>{const r=c.toggleUnitTemperature();U(r),l()});k?.addEventListener("click",()=>{c.currentDateMode="today",p(c.currentDateMode),l()});P?.addEventListener("click",()=>{c.currentDateMode="tommorow",p(c.currentDateMode),l()});b?.addEventListener("click",()=>{c.currentDateMode="threeDay",p(c.currentDateMode),l()});
